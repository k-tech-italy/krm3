{% extends "home.html" %}

{% load tailwind_tags static reports %}
{% load i18n %}

{% block extrastyle %}
    {% tailwind_css %}
{% endblock %}

{% block body %}
    {{ block.super }}
    <div class="w-9/10 mx-auto pt-20">
        <div class="flex flex-row justify-between mt-2">
            <a href="{% url "task-report-month" prev_month %}" class="button">{% translate "Prev month" %}</a>
            <div class="flex flex-col">
                <h1 class="title">{% blocktranslate %}Task Report {{ title }}{% endblocktranslate %}</h1>
            </div>
            <a href="{% url "task-report-month" next_month %}" class="button">{% translate "Next month" %}</a>
        </div>
        {% for report_block in report_blocks %}
            <div class="report-container">
                <table class="report-table">
                    <thead>
                    <tr class="table-header-row">
                        <td class="row-header">
                            <strong>{{ report_block.resource.last_name }}</strong> {{ report_block.resource.first_name }}
                        </td>
                        <td class="row-header">{% translate "Days" %} {{ report_block.rows.0.cells.0.render }}</td>
                        <td>{% translate "Total HH" %} {{ report_block.rows.0.cells.1.render }}</td>
                        {% for cell in report_block.rows.0.cells|slice:"2:" %}
                            <td class="pending">
                                <p>{{ cell.value.day_of_week_short_i18n }}</p>
                                <p>{{ cell.value.date.day }}</p>
                            </td>
                        {% endfor %}

                    </tr>
                    </thead>
                    <tbody>
                    {% if not report_block.has_tasks %}
                        <!-- Show message when no tasks are assigned -->
                        <tr class="row-data">
                            <td class="text-left" colspan="{{ report_block.width|default:'30' }}">{% translate "No tasks assigned" %}</td>
                        </tr>
                    {% else %}
                        <!-- Show task rows when tasks exist -->
                        {% for row in report_block.rows|slice:"1:" %}
                            <tr class="row-data">
                                <td class="row-header">{{ row.cells.0.render }}</td>

                                {% if "Tot per Giorno" in row.cells.0.render %}
                                    {% for cell in row.cells|slice:"1:" %}
                                        <td class="cell-data {% if cell.nwd %}non-workday{% endif %}">
                                            {{ cell.render }}
                                        </td>
                                    {% endfor %}
                                {% else %}
                                    {% for cell in row.cells|slice:"1:" %}
                                        <td class="cell-data {% if cell.nwd %}non-workday{% endif %}">
                                            {{ cell.render }}
                                        </td>
                                    {% endfor %}
                                    <td></td>
                                {% endif %}
                            </tr>
                        {% endfor %}
                    {% endif %}
                    </tbody>
                </table>
            </div>
        {% endfor %}

    </div>

{% endblock body %}
